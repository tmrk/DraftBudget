// === JetBrains Mono Font (embedded) ===
@font-face {
  font-family: 'JetBrains Mono';
  src: url('./fonts/JetBrainsMono-ExtraLight.woff2') format('woff2');
  font-weight: 200;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'JetBrains Mono';
  src: url('./fonts/JetBrainsMono-Regular.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'JetBrains Mono';
  src: url('./fonts/JetBrainsMono-Medium.woff2') format('woff2');
  font-weight: 500;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'JetBrains Mono';
  src: url('./fonts/JetBrainsMono-Bold.woff2') format('woff2');
  font-weight: 700;
  font-style: normal;
  font-display: swap;
}

// === SCSS Variables ===
$font-family: 'JetBrains Mono', monospace;
$font-size: 13px;
$bg-color: #0a0a0a;
$text-color: rgba(255, 255, 255, 0.92);
$text-muted: rgba(255, 255, 255, 0.5);
$accent-green: rgba(0, 200, 80, 0.9);
$accent-red: rgba(220, 60, 60, 0.9);

// Gap size for grid dividers
$gap-size: 1px;

// Cell horizontal padding
$cell-padding: calc(1ch - 1px);

// Level background colors are now defined in config.js (config.default.lineColours)

// Icons are now inline SVGs in Line.js

// Header icons
$icon-tag: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff' opacity='0.6'%3E%3Cpath d='M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z'/%3E%3C/svg%3E");
$icon-title: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff' opacity='0.6'%3E%3Cpath d='M5 4v3h5.5v12h3V7H19V4z'/%3E%3C/svg%3E");

// === Reset ===
* {
  margin: 0;
  padding: 0;
  list-style-type: none;
  user-select: none;
  -webkit-user-select: none;
  box-sizing: border-box;
}

// === Utility Classes ===
.hidden {
  display: none !important;
}

// Invisible hides only the span text, not the cell background
.invisible > span {
  visibility: hidden;
}

.alignright {
  text-align: right;
}

// === Base Elements ===
html {
  height: 100%;
}

body {
  height: 100%;
  font-family: $font-family;
  font-size: $font-size;
  line-height: 1.4;
  background: $bg-color;
  color: $text-color;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

// === Budget Container ===
.budget {
  width: 100%;
  max-width: 1600px;
  margin: 0 auto;
  display: block;
  text-align: center;

  // CSS Custom Properties for column widths (ch-based)
  // These are minimum widths - JS will auto-resize based on content
  --col-index: 9ch;
  --col-title: 20ch;
  --col-qty: 2ch;       // unitNumber min
  --col-type: 3ch;      // unitType min
  --col-rate: 7ch;      // unitCost min
  --col-ucurr: 3ch;     // unitCurrency min
  --col-cost: 7ch;      // cost min (hidden)
  --col-freq: 2ch;      // frequency min
  --col-total: 7ch;     // total min
  --col-curr: 3ch;      // currency min
  --col-tools: 56px;
  --row-height: 3.2ch;
  --header-height: 4ch;

  // Column widths - col2 (title) flexes, others use CSS vars set by JS
  .col1 { width: var(--col-index); min-width: var(--col-index); }
  .col2 { width: var(--col-title); flex-grow: 1; }
  .col3 { width: var(--col-qty); min-width: 2ch; }
  .col4 { width: var(--col-type); min-width: 3ch; }
  .col5 { width: var(--col-rate); min-width: 7ch; }
  .col6 { width: var(--col-ucurr); min-width: 3ch; }
  .col7 { width: var(--col-cost); min-width: 7ch; }
  .col8 { width: var(--col-freq); min-width: 2ch; }
  .col9 { width: var(--col-total); min-width: 7ch; }
  .col10 { width: var(--col-curr); min-width: 3ch; }
  .col11 { width: var(--col-tools); min-width: var(--col-tools); }

  // Hidden columns (kept in DOM for future settings panel)
  .col7 { display: none; }

  // Root list
  > .root {
    text-align: left;
  }

  // Footer
  > footer {
    height: 5ch;
  }

  // Buttons
  > button {
    width: 40ch;
    margin: 1.5ch;
    padding: 1ch 2ch;
    border: 1px solid rgba(255, 255, 255, 0.25);
    background: transparent;
    display: inline-block;
    font-family: inherit;
    font-size: 0.9em;
    color: $text-color;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    transition: all 0.15s ease;

    &:hover {
      background: rgba(0, 200, 80, 0.15);
      border-color: $accent-green;
      color: #fff;
    }
  }
}

// === Props Row (shared between header and data rows) ===
.props {
  margin: 0 0 $gap-size 0; // Bottom margin creates row gap
  padding: 0;
  height: var(--row-height);
  display: flex;
  align-items: stretch;
  gap: $gap-size;
  background: transparent; // Gaps show page background

  // All columns - cells with individual backgrounds
  > *[class^="col"] {
    display: flex;
    align-items: stretch; // Make children fill height
    overflow: hidden;
    // Background color applied via JS from config.default.lineColours

    // Span fills entire cell, text is padded inside
    > span {
      width: 100%;
      padding: 0 $cell-padding;
      display: flex;
      align-items: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  }

  // Muted text for non-editable columns
  > *:not(.editable) {
    color: $text-muted;
  }

  > .editable {
    > span {
      color: $text-color;
      cursor: pointer;
      transition: background 0.1s ease;

      // Hover fills entire cell
      &:hover {
        background: rgba(255, 255, 255, 0.1);
      }
    }
  }

  // Hide span when editing
  > div.editing > span {
    display: none;
  }

  // Tools column
  > .col11 {
    padding: 0;
    display: flex;
    justify-content: stretch;
    align-items: stretch;
    gap: $gap-size;
    background: transparent; // Gap shows page background between buttons

    > span.button {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      overflow: hidden;
      // Background color applied via JS from config.default.lineColours

      svg {
        width: 20px;
        height: 20px;
        fill: $text-color;
        opacity: 0.5;
        flex-shrink: 0;
      }
    }

    > .delete {
      &:hover {
        background-color: $accent-red !important;

        svg {
          opacity: 1;
        }
      }
    }

    > .add {
      &:hover {
        background-color: $accent-green !important;

        svg {
          opacity: 1;
        }
      }
    }
  }
}

// === Header Row ===
.budget > header.line > .props {
  height: var(--header-height);
  background: transparent;

  > *[class^="col"] {
    background-color: transparent;

    > span {
      justify-content: center; // Center header titles
      text-align: center;
      font-weight: 700;
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: $text-muted;
    }
  }

  // Empty tools column in header
  > .col11 {
    background-color: transparent;
  }
}

// === Root Line (Budget) ===
ul.root > li.line > .props {
  height: 5ch;

  > div > span {
    font-weight: bold;
  }

  > div.alignright > span {
    text-align: right;
  }

  // Hide index on root line
  > .index > span {
    visibility: hidden;
  }

  // Tools on root line - hide delete on root line
  > .col11 > .button.delete {
    display: none;
  }
}

// Level-specific backgrounds are now applied via JavaScript from config.default.lineColours

// === Level-specific font weights ===
// Root and Level 1: Bold (700)
ul.root > li.line > .props > div > span,
li.line.level1 > .props > div > span {
  font-weight: 700;
}

// Level 2: Medium (500)
li.line.level2 > .props > div > span {
  font-weight: 500;
}

// Level 3: Regular (400) - default, no override needed

// Level 4+: ExtraLight (200)
li.line.level4 > .props > div > span {
  font-weight: 200;
}

// === Column alignments for data rows ===
// Right-aligned: Rate (col5), Cost (col7), Total (col9)
li.line > .props {
  > .col5 > span,
  > .col7 > span,
  > .col9 > span {
    justify-content: flex-end;
    text-align: right;
  }

  // Center-aligned: Qty (col3), Type (col4), Unit Cur (col6), Fr (col8), Cur (col10)
  > .col3 > span,
  > .col4 > span,
  > .col6 > span,
  > .col8 > span,
  > .col10 > span {
    justify-content: center;
    text-align: center;
  }
}

// Disabled add button on max level
.button.add.disabled {
  pointer-events: none;

  svg path {
    fill: rgba(255, 255, 255, 0.2);
  }
}

// === Editing Mode - Input fills entire cell ===
.editing input {
  width: 100%;
  height: 100%;
  padding: 0 $cell-padding; // Match span padding for text alignment
  border: none;
  outline: none;
  background: #ffffff;
  font-family: inherit;
  font-size: inherit;
  color: #000000;
  user-select: text;
  -webkit-user-select: text;
  cursor: text;
}

.editing.alignright input {
  text-align: right;
}

// === Overhead Lines ===
li.line.overhead {
  > .props {
    // Overhead lines use slightly muted text for visual distinction
    opacity: 0.85;

    // Index column shows "OH1-1.2.3" format
    > .col1.overhead-index > span {
      font-style: italic;
      color: $text-muted;
    }

    // Percentage display in col5
    > .col5.percentage > span {
      justify-content: flex-end;
      text-align: right;
    }

    // Invisible columns still take up space
    > .invisible {
      > span {
        visibility: hidden;
      }
    }

    // Move up/down buttons
    > .col11 {
      > .move-up,
      > .move-down {
        &:hover {
          background-color: rgba(100, 150, 255, 0.4) !important;

          svg {
            opacity: 1;
          }
        }
      }
    }
  }
}

// Level-specific styling for overhead lines
li.line.overhead.level1 > .props > div > span,
li.line.overhead.level2 > .props > div > span,
li.line.overhead.level3 > .props > div > span,
li.line.overhead.level4 > .props > div > span {
  font-weight: 400; // Normal weight for all overhead lines
}

// === Grand Total Row ===
.grandtotal {
  height: 4.5ch;
  padding: 0;
  margin-top: $gap-size;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  font-weight: bold;
  gap: 0;

  .title {
    padding: 0 2ch;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-size: 0.9em;
  }

  .amount {
    width: 10ch;
    padding: 0 1ch;
    text-align: right;
    user-select: text;
    -webkit-user-select: text;
    cursor: text;
  }

  .currency {
    width: var(--col-curr);
    padding: 0 $cell-padding;
  }

  // Spacer for tools column alignment
  &::after {
    content: '';
    width: var(--col-tools);
    min-width: var(--col-tools);
  }
}

// === Export Section ===
#export {
  margin: 2ch 0 0;
  text-align: center;

  > span {
    padding: 1ch;
    display: inline-block;
    cursor: pointer;

    &:hover {
      color: $accent-green;
    }
  }
}

// === Pre/Code Blocks ===
pre {
  background: rgba(255, 255, 255, 0.05);
  max-height: 30ch;
  padding: 2ch;
  border: 1px solid rgba(255, 255, 255, 0.25);
  line-height: 1.5;
  text-align: left;
  overflow-x: auto;
}

// === Body Header/Footer ===
body > header {
  margin: 0 auto;
  padding: 2.5ch 0;
  text-align: center;
  background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, transparent 100%);

  h1 {
    font-size: 1.8em;
    font-weight: 400;
    letter-spacing: 0.3em;
    text-transform: uppercase;
  }

  h2 {
    color: $text-muted;
    font-size: 0.8em;
    font-weight: 400;
    letter-spacing: 0.4em;
    text-transform: uppercase;
    margin-top: 0.5ch;
  }
}

body > footer {
  height: 6ch;
  margin-top: 2ch;
  padding: 0 2ch;
  display: flex;
  gap: 4ch;
  align-items: center;
  justify-content: center;
  text-align: center;
  color: $text-muted;
  font-size: 0.85em;

  strong {
    cursor: pointer;
    padding: 0.5ch 1ch;
    border: 1px solid transparent;
    transition: all 0.15s ease;

    &:hover {
      color: $accent-green;
      border-color: rgba(0, 200, 80, 0.3);
    }
  }
}
