(()=>{"use strict";var __webpack_modules__={390:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x:()=>Line});var _config_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(597),_log_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(928),_dom_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(596),_fx_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(521),_serialize_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(344),_persistence_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(247);class Line{static get maxLevel(){return _config_js__WEBPACK_IMPORTED_MODULE_0__.v.levelNames.length-1}constructor(options={},level=0){level<Line.maxLevel&&_config_js__WEBPACK_IMPORTED_MODULE_0__.v.levelNames[level+1];this.view={buttonDelete:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span.button.delete","",{click:function(){this.remove()}.bind(this)}),buttonAdd:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span.button.add","",{click:function(e){if(e.stopImmediatePropagation(),!this.canAddChildren())return void(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Cannot add children to "+this.levelName+" (max level reached)","warn");this.add();this.children[this.children.length-1].viewEdit("title")}.bind(this)}),props:{index:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.col1.index",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",this.index)),title:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.col2.title.editable",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",this.title)),unitNumber:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.col3.unitnumber.editable",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",this.unitNumber)),unitType:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.col4.unittype.editable",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",this.unitType)),unitCost:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.col5.unitcost.alignright.editable",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.YO)(this.unitCost))),frequency:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.col6.frequency.alignright.editable",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",this.frequency)),cost:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.col7.cost.alignright",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.YO)(this.cost))),total:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.col8.total.alignright",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.YO)(this.total))),currency:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.col9.currency.editable",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",this.currency)),tools:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.col10.tools")},children:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("ul.children"),overhead:(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("ul.overhead")},this.view.props.tools.append(this.view.buttonDelete,this.view.buttonAdd);for(let v in options)options.hasOwnProperty(v)&&"children"!==v&&(this[v]=options[v]);this.currency=this.currency||_config_js__WEBPACK_IMPORTED_MODULE_0__.v.default.currency,this._start||(this.start=(new Date).getTime()),this._end||(this.end=this._start+864e5),this.created=this.created||(new Date).getTime(),this.modified=this.modified||this.created;for(let property in this.view.props){const propNode=this.view.props[property];propNode.setAttribute("data-property",property),propNode.classList.contains("editable")?propNode.addEventListener("click",function(e){e.stopPropagation();const property=propNode.dataset.property;this.viewEdit(property)}.bind(this)):"total"!=property&&"cost"!=property||propNode.addEventListener("click",function(e){e.stopPropagation(),this.children&&this.children.length||this.viewEdit("unitCost")}.bind(this))}this.view.node=(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("li.line",[(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.props",[this.view.props.index,this.view.props.title,this.view.props.unitNumber,this.view.props.unitType,this.view.props.unitCost,this.view.props.frequency,this.view.props.cost,this.view.props.total,this.view.props.currency,this.view.props.tools]),this.view.children,this.view.overhead])}set modified(date){this._modified=date,(0,_persistence_js__WEBPACK_IMPORTED_MODULE_5__.cI)()}set start(date){this._start=date,this.modified=(new Date).getTime()}set end(date){this._end=date,this.modified=(new Date).getTime()}set title(title){title&&title.trim()&&title!==this.title&&(this._title=title),this.modified=(new Date).getTime(),this.viewUpdate(!1,["title"])}set unitNumber(unitNumber){this._unitNumber=unitNumber,this.modified=(new Date).getTime(),this.viewUpdate(!1,["unitNumber","cost"]),this.viewUpdate("up",["total"])}set unitType(unitType){this._unitType=unitType,"ls"!=unitType&&"lumpsum"!=unitType||(this.unitNumber=1),this.modified=(new Date).getTime(),this.viewUpdate(!1,["unitType"])}set unitCost(unitCost){this._unitCost=unitCost,this.modified=(new Date).getTime(),this.viewUpdate(!1,["unitCost","cost"]),this.viewUpdate("up",["total"])}set frequency(frequency){this._frequency=frequency,this.modified=(new Date).getTime(),this.viewUpdate(!1,["frequency"]),this.viewUpdate("up",["total"])}set currency(currency){_fx_js__WEBPACK_IMPORTED_MODULE_3__.uH.hasOwnProperty(currency.toUpperCase())&&(this._currency=currency,this.modified=(new Date).getTime()),this.viewUpdate(!1,["currency"]),this.viewUpdate("up",["total"])}set category(category){Array.isArray(category)?this._category=category:this._category=[category],this.modified=(new Date).getTime()}get modified(){return(this.getLast("_modified",!0)||this)._modified}get start(){return(this.getFirst("_start",!0)||this)._start}get end(){return(this.getLast("_end",!0)||this)._end}get duration(){return this.end-this.start}get defaultTitle(){return this.levelName+"-"+this.lineNumber}get title(){return(this._title||this.defaultTitle).trim()}get unitNumber(){return this._unitNumber}get unitType(){return this._unitType}get unitCost(){return this._unitCost}get frequency(){return this._frequency}get currency(){return(this._currency||_config_js__WEBPACK_IMPORTED_MODULE_0__.v.default.currency).substring(0,3).toUpperCase()}get cost(){return this.unitNumber*this.unitCost}get totalWithoutOverhead(){let total=0;if(this.children&&this.children.length)for(var i=0;i<this.children.length;i++){let base=this.children[i].currency;this.currency!==base?total+=(0,_fx_js__WEBPACK_IMPORTED_MODULE_3__.OQ)(this.children[i].total,base,this.currency):total+=this.children[i].total}else total=this.cost?this.cost*this.frequency:0;return total}get total(){let total=this.totalWithoutOverhead;if(this.overhead&&this.overhead.length)for(let i=0;i<this.overhead.length;i++)total+=this.overhead[i].cost;return total}get level(){return this.parent?this.parent.level+1:0}get levelName(){return _config_js__WEBPACK_IMPORTED_MODULE_0__.v.levelNames[this.level]}get category(){return this._category||[]}get lineNumber(){return this.level>0?this.parent.children.indexOf(this)+1:1}get absLineNumber(){let line=this,absLineNumber=0;for(;line.before;)absLineNumber+=1,line=line.before;return absLineNumber}get index(){let index=[],line=this;for(;line.level>0;)index.unshift(line.lineNumber),line=line.parent;return index.length?index.join("."):0}get root(){let root=this;for(;root.level;)root=root.parent;return root}get ancestors(){let ancestors=[],current=this;for(;current.parent;)ancestors.push(current.parent),current=current.parent;return ancestors}get siblings(){let siblings=[];for(let i=0;i<this.parent.children.length;i++)this.parent.children[i]!==this&&siblings.push(this.parent.children[i]);return siblings}get descendants(){let descendants=[];if(this.children)for(let i=0;i<this.children.length;i++)descendants.push(this.children[i]),descendants=descendants.concat(this.children[i].descendants);return descendants}get before(){if(1===this.lineNumber)return this.parent;{let prevSibling=this.parent.getLine(this.lineNumber-1);return prevSibling.children?prevSibling.descendants[prevSibling.descendants.length-1]:prevSibling}}get after(){if(this.children)return this.children[0];if(this.level&&this.parent.children[this.lineNumber])return this.parent.children[this.lineNumber];if(this.level){for(var current=this;current.level&&!current.parent.children[current.lineNumber];)current=current.parent;return current.parent.children[current.lineNumber]}}get currencies(){let currencies=[this.currency];if(currencies.includes(_config_js__WEBPACK_IMPORTED_MODULE_0__.v.default.currency)||currencies.push(_config_js__WEBPACK_IMPORTED_MODULE_0__.v.default.currency),this.children)for(var i=0;i<this.children.length;i++)for(var j=0;j<this.children[i].currencies.length;j++)currencies.includes(this.children[i].currencies[j])||currencies.push(this.children[i].currencies[j]);return currencies.sort()}canAddChildren(){return this.level<Line.maxLevel}viewAdd(newLine,index){this.view.children.appendChild(newLine.view.node),newLine.view.node.dataset.level=this.level+1,newLine.view.node.classList.add("level"+(this.level+1)),this.level+2==_config_js__WEBPACK_IMPORTED_MODULE_0__.v.levelNames.length&&newLine.view.node.classList.add("hide-add-button"),newLine.viewUpdate(),newLine.parent.viewUpdate("up")}viewEdit(property){const propNode=this.view.props[property],propNodeInput=propNode.querySelector("input");if(propNodeInput)propNodeInput.focus();else{const previousEditing=this.root.view.node.querySelector(".editing input"),pressEnter=new KeyboardEvent("keydown",{key:"Enter"});previousEditing&&previousEditing.dispatchEvent(pressEnter),propNode.classList.add("editing");const originalValue=this[property],removeInput=saveEdit=>{document.removeEventListener("click",removeInput),this[property]=saveEdit?inputEdit.value:originalValue,inputEdit.remove(),propNode.classList.remove("editing"),(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Editing "+this.index+" "+property+" finished, changes "+(saveEdit?"saved.":"discarded."),"info")};document.addEventListener("click",removeInput);const inputEdit=(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("input|value="+originalValue+"|placeholder="+this.defaultTitle,"",{input:function(event){this[property]=event.target.value}.bind(this),keydown:function(event){switch(event.key){case"Tab":event.preventDefault();const editables=this.root.view.node.querySelectorAll(".editable:not(.invisible)"),thisIndex=Array.from(editables).indexOf(propNode),nextIndex=editables.length-1!==thisIndex?thisIndex+1:0;removeInput(!0),editables[nextIndex].click();break;case"ArrowUp":case"ArrowDown":event.preventDefault();const sameColumn=this.root.view.node.querySelectorAll(".editable:not(.invisible)[data-property="+property+"]"),thisIndexCol=Array.from(sameColumn).indexOf(propNode),prevIndexCol=0!==thisIndexCol?thisIndexCol-1:sameColumn.length-1,nextIndexCol=sameColumn.length-1!==thisIndexCol?thisIndexCol+1:0,indexToSelect="ArrowUp"==event.key?prevIndexCol:nextIndexCol;removeInput(!0),sameColumn[indexToSelect].click();break;case"Enter":event.preventDefault(),removeInput(!0);break;case"Escape":event.preventDefault(),removeInput(!1)}}.bind(this)});propNode.appendChild(inputEdit),inputEdit.focus(),inputEdit.select(),(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Editing "+this.index+" "+property)}}viewRemove(){this.view.node.remove(),this.parent.viewUpdate("updown")}viewUpdate(recursion,properties){switch(recursion){case"down":if(this.viewUpdate(!1,properties),this.children)for(let i=0;i<this.children.length;i++)this.children[i].viewUpdate("down",properties);break;case"up":this.viewUpdate(!1,properties),this.parent&&this.parent.viewUpdate("up");break;case"updown":this.viewUpdate("down",properties),this.viewUpdate("up",properties);break;case"side":this.viewUpdate(!1,properties),console.log(this.siblings);for(let i=0;i<this.siblings.length;i++)this.siblings[i].viewUpdate("down",properties);default:if(properties)for(let i=0;i<properties.length;i++){const property=properties[i];if(this.view.props[property]){let newValue="unitCost"==property||"cost"==property||"total"==property?(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.YO)(this[property]):this[property];this.view.props[property].querySelector("span").textContent=newValue,"unitCost"!=property&&"unitNumber"!=property&&"frequency"!=property||this.viewUpdate(!1,["cost","total"])}}else for(let property in this.view.props)if("tools"!==property&&this.view.props.hasOwnProperty(property)){let newValue="unitCost"==property||"cost"==property||"total"==property?(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.YO)(this[property]):this[property];this.view.props[property].querySelector("span").textContent=newValue}this.viewUpdateGrandTotal()}const leafFields=[this.view.props.unitNumber,this.view.props.unitType,this.view.props.unitCost,this.view.props.frequency,this.view.props.cost];for(let i=0;i<leafFields.length;i++)this.children&&this.children.length?leafFields[i].classList.add("invisible"):leafFields[i].classList.remove("invisible")}viewUpdateGrandTotal(){if(this.root.view.grandTotal){const grandTotal=this.root.view.grandTotal.querySelector(".amount"),currency=this.root.view.grandTotal.querySelector(".currency");grandTotal.textContent=(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.YO)(this.root.total),currency.textContent=this.root.currency}}viewAddOverhead(newOverhead){this.view.overhead.classList.add("hasoverhead");const viewNewOverhead=(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("li.overhead",[(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span","Overhead for "+this.index),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span.title",newOverhead.title),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span.rate",newOverhead.rate),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span.cost",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.YO)(newOverhead.cost)),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",this.currency)]);this.view.overhead.appendChild(viewNewOverhead)}viewUpdateOverhead(index,properties){if(this.overhead[index]){if(properties)for(let i=0;i<properties.length;i++){const property=properties[i];this.view.overhead.querySelector("."+property).textContent=this.overhead[property]}else this.viewUpdateOverhead(index,Object.keys(this.overhead[index]));this.viewUpdate("up",["total"])}}appendToBody(){if(this.root.appendedToBody)(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("The root of this budget has already been added to the page.","error");else{const header=(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("header.line",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".props",[(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".col1",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span","#")),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".col2",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span","Title")),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".col3",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span","Qty")),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".col4",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span","Type")),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".col5",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span","Rate")),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".col6",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span","Fr")),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".col7",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span","Cost")),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".col8",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span","Total")),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".col9",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span","Cur")),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)(".col10",(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("span",""))]));this.root.view.grandTotal=(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("footer.grandtotal",[(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("strong.title.alignright","Grand Total"),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("strong.amount.alignright",this.root.total),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("strong.currency",this.root.currency)]),document.body.appendChild((0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("div.budget",[header,(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("ul.root",this.root.view.node),this.root.view.grandTotal,(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("button","Export to Excel",{click:function(){(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Excel export not implemented","warn")}}),(0,_dom_js__WEBPACK_IMPORTED_MODULE_2__.n)("button","Export to JSON",{click:function(){let a=document.createElement("a");document.body.appendChild(a),a.style="display: none";let data=(0,_serialize_js__WEBPACK_IMPORTED_MODULE_4__.exportToJSON)(this),blob=new Blob([data],{type:"text/plain;charset=utf-8"}),url=window.URL.createObjectURL(blob);a.href=url,a.download=this.title.split(" ").join("_")+"_"+(new Date).toISOString().replace(/[-:]/g,"").replace("T","_").split(".")[0]+".json",a.click(),window.URL.revokeObjectURL(url),a.remove()}.bind(this)})])),this.root.appendedToBody=!0}}add(options={},index){if(!this.canAddChildren())return(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Cannot add children to "+this.levelName+" (max level "+Line.maxLevel+" reached)","error"),null;let newParent=this;if(options.unitNumber=options.unitNumber||newParent.unitNumber||1,options.unitType=options.unitType||newParent.unitType||"ls",options.unitCost=options.unitCost||newParent.unitCost||0,options.frequency=options.frequency||newParent.frequency||1,options.currency=options.currency||newParent.currency||this.root.currency,this._unitNumber=0,this._unitType="",this._unitCost=0,this._frequency=0,index&&"string"==typeof index){let map=index.split(".");index=Number(map.pop()),newParent=this.getLine(map.join("."))}const newLine=new Line(options,this.level+1);Object.defineProperty(newLine,"parent",{get:()=>newParent}),newParent.children?index&&index<newParent.children.length?newParent.children.splice(index-1,0,newLine):this.children.push(newLine):newParent.children=[newLine],newParent.viewAdd(newLine),(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.Fj)()||(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("New line added at "+newLine.index)}addLine(newLine,index){if(newLine instanceof Line){let newParent=this;Object.defineProperty(newLine,"parent",{get:()=>newParent}),newParent.children?index&&index<this.children.length?newParent.children.splice(index-1,0,newLine):this.children.push(newLine):newParent.children=[newLine],newParent.viewAdd(newLine,index)}else(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)(newLine.toString()+" is not a Line object","error")}remove(quietMode){let index=this.index,lineNumber=this.lineNumber;this.parent.children.splice(lineNumber-1,1),this.viewRemove(),quietMode||(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Line "+index+" deleted","info")}move(newIndex,addAsChild){const clone=(0,_serialize_js__WEBPACK_IMPORTED_MODULE_4__.cloneLine)(this);console.log(clone)}recurse(line,callback){if(callback(line),line.children)for(var i=0;i<line.children.length;i++)this.recurse(line.children[i],callback)}refreshLevels(){this.recurse(this,(line=>{for(let i=0;i<10;i++)line.view.node.classList.remove("level"+i);line.view.node.classList.add("level"+line.level),line.view.node.dataset.level=line.level,line.viewUpdate(!1,["index"])}))}getDuration(measure){switch(measure){case"y":return this.duration/31536e6;case"m":return this.duration/2628e6;case"w":return this.duration/6048e5;case"d":return this.duration/864e5;default:return this.duration}}getLine(index){if(index){if("number"==typeof index){if(this.children){if(this.children[index-1])return this.children[index-1];console.error("Line "+this.index+"."+index+" does not exist")}else console.error("Line "+this.index+" does not have any children");return!1}{let map=index.split("."),line=this;for(var i=0;i<map.length;i++)line=line.getLine(Number(map[i]));return line}}return this}getFirst(property,deepSearch,type){return this.getLast(property,deepSearch,type,!0)}getLast(property="created",deepSearch,type="children",getFirst){let items=deepSearch?this.descendants:this[type],map=[];for(let i=0;i<items.length;i++)map.push({index:items[i].index,property:items[i][property]});if(map.length){map=map.sort((function(a,b){return a.property>b.property?-1:b.property>a.property?1:0}));let index=getFirst?map[map.length-1].index:map[0].index;return this.root.getLine(index)}}addOverhead(title,rate){const newOverhead={title,rate};Object.defineProperty(newOverhead,"cost",{get:function(){return this.totalWithoutOverhead*newOverhead.rate}.bind(this)}),this.overhead?this.overhead.push(newOverhead):this.overhead=[newOverhead],this.viewAddOverhead(newOverhead)}removeOverhead(index){this.overhead&&this.overhead[index]?(this.overhead.splice(index-1,1),(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Overhead "+index+" from line "+this.index+" deleted.","info")):(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Line "+this.index+" has no overhead at index "+index,"error"),this.viewUpdate("up",["total"])}updateOverhead(index,title,rate){this.overhead&&this.overhead[index]&&(title&&(this.overhead[index].title=title),rate&&(this.overhead[index].rate=rate),this.viewUpdateOverhead(index))}addCategory(category){if(this._category&&Array.isArray(category))for(var i=0;i<category.length;i++)this._category.push(category[i]);else this.category=category}removeCategory(category){}listCategory(category,line){let list=[];if((line=line||this).category&&line.category.includes(category)&&list.push(line.index),line.children)for(var i=0;i<line.children.length;i++)this.listCategory(category,line.children[i]),console.log(line.index);return list}update(options){for(var variable in options&&options.modified||(this.modified=(new Date).getTime()),options)options.hasOwnProperty(variable)&&(this[variable]=options[variable]);this.viewUpdate("up",Object.keys(options))}}},597:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{v:()=>config});const config={roundDecimals:2,showDecimals:2,levelNames:["Budget","Heading","Sub-heading","Activity","Sub-activity"],prefix:["R","A"],default:{currency:"USD",lineColours:["rgba(255,255,255,0.1)","rgba(255,255,255,0.2)","rgba(255,255,255,0.3)","rgba(255,255,255,0.5)","rgba(255,255,255,0.65)"],warnBeforeDelete:!1}}},596:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{YO:()=>formatN,n:()=>n});var _config_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(597);const n=(tag,content,listener)=>{let el=document.createElement(tag.split("#")[0].split(".")[0].split("|").shift()||"div");if(tag.split("#")[1]&&(el.id=tag.split("#")[1].split(".")[0].split("|")[0]),tag.split(".")[1]&&el.classList.add(...tag.split(".").slice(1).join(".").split("|")[0].split(".")),tag.split("|")[1]){let attrTemp=tag.split("|").slice(1);for(let i=0;i<attrTemp.length;i++)el.setAttribute(attrTemp[i].split("=")[0],attrTemp[i].split("=")[1])}if(content)if("string"==typeof content||"number"==typeof content)el.insertAdjacentHTML("beforeend",content);else if(content.constructor===Array)for(let i=0;i<content.length;i++)"string"==typeof content||"number"==typeof content?el.insertAdjacentHTML("beforeend",content[i]):el.appendChild(content[i]);else el.appendChild(content);if(listener)for(let event in listener)listener.hasOwnProperty(event)&&el.addEventListener(event,listener[event]);return el},formatN=function(number,showDecimals=_config_js__WEBPACK_IMPORTED_MODULE_0__.v.showDecimals,if0){if(number){let parts=parseFloat(number).toFixed(showDecimals).toString().split(".");return parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),parts.join(".")}return if0||0}},521:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{EE:()=>prewarmDefault,Jw:()=>prewarmAll,Mi:()=>loadRates,OQ:()=>convert,uH:()=>symbols,vI:()=>ratesByBase,ym:()=>saveRatesToLocalStorage});var _config_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(597),_log_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(928);let ratesByBase={},symbols={};const inFlight=new Set;let pendingRerender=null;const API_BASE="https://api.frankfurter.dev/v1";function saveCache(){try{localStorage.setItem("ratesByBase",JSON.stringify(ratesByBase)),localStorage.setItem("symbols",JSON.stringify(symbols))}catch(e){(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Failed to save FX cache: "+e.message,"warn")}}function isCacheValid(base){return!!ratesByBase[base]?.fetchedAt&&Date.now()-ratesByBase[base].fetchedAt<864e5}async function fetchRatesForBase(base,onComplete){if(inFlight.has(base))return null;inFlight.add(base);try{const response=await fetch(`${API_BASE}/latest?base=${base}`);if(!response.ok)throw new Error(`HTTP ${response.status}`);const data=await response.json();return ratesByBase[base]={fetchedAt:Date.now(),rates:{...data.rates,[base]:1}},saveCache(),(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)(`Exchange rates loaded for ${base}`),"function"==typeof onComplete&&(callback=onComplete,pendingRerender&&clearTimeout(pendingRerender),pendingRerender=setTimeout((()=>{pendingRerender=null,callback()}),100)),ratesByBase[base]}catch(error){return(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)(`Failed to fetch rates for ${base}: ${error.message}`,"error"),null}finally{inFlight.delete(base)}var callback}async function fetchCurrencies(){try{const response=await fetch(`${API_BASE}/currencies`);if(!response.ok)throw new Error(`HTTP ${response.status}`);symbols=await response.json(),saveCache(),(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Currency list loaded")}catch(error){(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)(`Failed to fetch currencies: ${error.message}`,"error")}}function convert(amount,from,to,onRatesLoaded){return(from=(from||_config_js__WEBPACK_IMPORTED_MODULE_0__.v.default.currency).toUpperCase())===(to=(to||_config_js__WEBPACK_IMPORTED_MODULE_0__.v.default.currency).toUpperCase())?amount:void 0!==ratesByBase[from]?.rates?.[to]?amount*ratesByBase[from].rates[to]:(isCacheValid(from)||inFlight.has(from)||fetchRatesForBase(from,onRatesLoaded),NaN)}async function prewarmDefault(defaultCurrency){defaultCurrency=defaultCurrency||_config_js__WEBPACK_IMPORTED_MODULE_0__.v.default.currency,function(){localStorage.removeItem("rates"),localStorage.removeItem("ratesUpdated"),localStorage.removeItem("ratesLocked");try{const cached=localStorage.getItem("ratesByBase");cached&&(ratesByBase=JSON.parse(cached));const cachedSymbols=localStorage.getItem("symbols");cachedSymbols&&(symbols=JSON.parse(cachedSymbols))}catch(e){(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("Failed to load FX cache: "+e.message,"warn")}}(),await fetchCurrencies(),isCacheValid(defaultCurrency)||await fetchRatesForBase(defaultCurrency)}async function prewarmAll(){await fetchCurrencies();const currencies=Object.keys(symbols);(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)(`Prewarming rates for ${currencies.length} currencies...`);for(const base of currencies)isCacheValid(base)||await fetchRatesForBase(base);(0,_log_js__WEBPACK_IMPORTED_MODULE_1__.cM)("All rates prewarmed")}const loadRates=prewarmDefault,saveRatesToLocalStorage=saveCache},928:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Fj:()=>getQuietMode,Pv:()=>setQuietMode,cM:()=>log,mt:()=>syslog});let syslog=[];try{const stored=localStorage.getItem("syslog");stored&&(syslog=JSON.parse(stored))}catch(e){}let _quietMode=!1;function getQuietMode(){return _quietMode}function setQuietMode(value){_quietMode=!!value}const log=function(message,type,timestamp){type=type||"log",timestamp=timestamp||(new Date).getTime(),syslog.push({m:message,t:type,ts:timestamp}),console[type](message)}},247:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Kj:()=>clearBudget,NK:()=>loadBudget,Qq:()=>setRootLine,cI:()=>scheduleSave});var _log_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(928);let saveTimeout=null,rootLine=null;function setRootLine(line){rootLine=line}function scheduleSave(){saveTimeout&&clearTimeout(saveTimeout),saveTimeout=setTimeout((()=>{!function(){if(!rootLine)return;try{Promise.resolve().then(__webpack_require__.bind(__webpack_require__,344)).then((({exportToJSON})=>{const data=exportToJSON(rootLine,!0);localStorage.setItem("budgetData",JSON.stringify(data)),(0,_log_js__WEBPACK_IMPORTED_MODULE_0__.cM)("Budget saved to localStorage")}))}catch(e){(0,_log_js__WEBPACK_IMPORTED_MODULE_0__.cM)("Failed to save budget: "+e.message,"error")}}()}),500)}function loadBudget(){try{const saved=localStorage.getItem("budgetData");if(saved){const data=JSON.parse(saved);return(0,_log_js__WEBPACK_IMPORTED_MODULE_0__.cM)("Budget loaded from localStorage"),data}}catch(e){(0,_log_js__WEBPACK_IMPORTED_MODULE_0__.cM)("Failed to load budget: "+e.message,"error")}return null}function clearBudget(){localStorage.removeItem("budgetData"),(0,_log_js__WEBPACK_IMPORTED_MODULE_0__.cM)("Budget data cleared from localStorage")}},344:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{cloneLine:()=>cloneLine,exportToJSON:()=>exportToJSON});var _Line_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(390);const exportToJSON=(line,outputAsObject,propertiesToExport)=>{propertiesToExport=propertiesToExport||["index","title","unitNumber","unitType","unitCost","frequency","cost","total","currency","start","end","created","modified"];const lineHasChildren=line.children&&line.children.length,exportObject={};for(let i=0;i<propertiesToExport.length;i++){const property=propertiesToExport[i];(line[property]||"index"===property)&&(["unitNumber","unitType","unitCost","frequency","cost"].includes(property)&&lineHasChildren||(exportObject[property]=line[property]))}if(lineHasChildren){exportObject.children=[];for(let i=0;i<line.children.length;i++){let childObject=exportToJSON(line.children[i],!0);exportObject.children.push(childObject)}}return outputAsObject?exportObject:JSON.stringify(exportObject)},cloneLine=line=>{const clone=line instanceof _Line_js__WEBPACK_IMPORTED_MODULE_0__.x?exportToJSON(line,!0,["level","title","unitNumber","unitType","unitCost","frequency","currency","start","end","created","modified"]):line,newLine=new _Line_js__WEBPACK_IMPORTED_MODULE_0__.x;if(clone.children&&clone.children.length)for(let i=0;i<clone.children.length;i++){const cloneChild=cloneLine(clone.children[i]);newLine.addLine(cloneChild)}for(let property in clone)clone.hasOwnProperty(property)&&clone[property]&&"level"!==property&&"index"!==property&&"children"!==property&&(newLine[property]=clone[property]);return newLine}}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),__webpack_require__.r=exports=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},(()=>{var Line=__webpack_require__(390),log=__webpack_require__(928),dom=__webpack_require__(596),fx=__webpack_require__(521),serialize=__webpack_require__(344),config=__webpack_require__(597);var persistence=__webpack_require__(247);const createBudget=(varName,options={},savedData=null)=>{(0,log.cM)(varName),window[varName]?(0,log.cM)("The variable '"+varName+"' is not available. Please choose a different variable name.","error"):(window[varName]=savedData?(0,serialize.cloneLine)(savedData):new Line.x(options),window[varName].appendToBody(),(0,persistence.Qq)(window[varName]),"budget"===varName&&(window.b=window[varName]))};!function(){window.createBudget=createBudget,window.exportToJSON=serialize.exportToJSON,window.cloneLine=serialize.cloneLine,window.convert=fx.OQ,window.loadRates=fx.EE,window.prewarmAll=fx.Jw,Object.defineProperty(window,"rates",{get:()=>fx.vI,configurable:!0}),Object.defineProperty(window,"symbols",{get:()=>fx.uH,configurable:!0}),Object.defineProperty(window,"quietMode",{get:log.Fj,set:log.Pv,configurable:!0}),window.config=config.v,window.syslog=log.mt,window.log=log.cM,(0,fx.Mi)(),window.addEventListener("offline",(function(e){(0,log.cM)("You've just gone offline.","warn")})),window.addEventListener("online",(function(e){(0,log.cM)("Back online.","info")})),document.body.appendChild((0,dom.n)("header",[(0,dom.n)("h1","DraftBudget"),(0,dom.n)("h2","pre-alpha")]));const savedData=(0,persistence.NK)();var b;savedData?(createBudget("budget",{},savedData),window.budget.refreshLevels()):(createBudget("budget",{title:"My new budget"}),(b=window.budget)&&b instanceof Line.x&&((0,log.Pv)(!0),b.add(),b.getLine(1).add(),b.getLine("1.1").add(),b.getLine("1.1.1").add(),(0,log.Pv)(!1),console.log(window.budget))),document.body.appendChild((0,dom.n)("footer",[(0,dom.n)("span","Debug:"),(0,dom.n)("strong","Clear localStorage",{click:function(){(0,persistence.Kj)(),localStorage.clear(),(0,log.cM)("Local Storage cleared. Refresh to start fresh.","info")}}),(0,dom.n)("strong","Save rates and symbols to localStorage",{click:function(){(0,fx.ym)()}})]))}()})()})();